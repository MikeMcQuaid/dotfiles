#!/usr/bin/env bash

set -e

log() { echo -e "\033[0;35m${1}...\033[0m"; }

# Ask for the administrator password upfront.
sudo -v

log 'Updating macOS'
sudo softwareupdate --install --all

log 'Updating Mac App Store Apps'
mas upgrade

log 'Updating Homebrew casks'
brew update
brew upgrade
BREW_CACHE=$(brew --cache)
rm -rfv "${BREW_CACHE:?}/*"
brew tap --repair
brew cleanup

log 'Updating Composer'
composer self-update
composer global update --no-dev --prefer-dist

log 'Updating Valet'
valet install

log 'Updating npm'
npm install --global npm@latest
npm update --global

# Revoke sudo access again.
sudo -k
