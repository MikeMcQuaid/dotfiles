#!/bin/bash
# Run by Strap after installing Brewfile dependencies

set -eo pipefail

cd "$(dirname "$0")/.." || exit

# Close terminal windows on successful exit code
/usr/libexec/PlistBuddy ~/Library/Preferences/com.apple.Terminal.plist -c \
  "Set 'Window Settings':Basic:shellExitAction 1" || true
defaults read com.apple.Terminal >/dev/null 2>&1 || true

# Enable Touch ID for sudo
bin/touchid-enable-pam-sudo --quiet || true

# Use ZSH as my default Shell
if [ "${SHELL}" != "/bin/zsh" ]; then
  sudo chsh -s /bin/zsh "${USER}"
fi

# Ensure auto-update is always enabled
if [ "$(defaults read /Library/Preferences/com.apple.commerce.plist AutoUpdate)" != "1" ]; then
  sudo defaults write /Library/Preferences/com.apple.commerce.plist AutoUpdate 1
fi

# macOS appearance: Auto (Light by day, Dark by night)
defaults write -g AppleInterfaceStyleSwitchesAutomatically -bool true

# Dock aligned to the left
defaults write com.apple.dock orientation -string left
killall Dock || true

# Prefer tabs when opening documents: Always
defaults write -g AppleWindowTabbingMode -string Always

# Unset default system-wide Git credential helper
git config unset --system credential.helper
